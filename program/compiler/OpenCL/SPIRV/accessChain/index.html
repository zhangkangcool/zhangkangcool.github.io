<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">
        <title>accessChain - My Docs</title>
        <link href="../../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../OpenCV/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8OpenCL%E4%BB%A3%E7%A0%81/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../%E5%88%86%E6%9E%90/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#1-opaccesschain" class="nav-link">1. OpAccessChain 的基本定义</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#2-opaccesschain" class="nav-link">2. OpAccessChain 的典型使用场景</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#3-opaccesschain-opptraccesschain" class="nav-link">3. OpAccessChain 与 OpPtrAccessChain 的区别</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#4" class="nav-link">4. 注意事项</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#5" class="nav-link">5. 示例代码总结</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>在SPIR-V（Standard Portable Intermediate Representation for Vulkan）中，<code>OpAccessChain</code> 是一个非常重要的指令，用于访问复合类型（如数组、结构体、向量、矩阵等）中的特定元素。它是操作内存中复杂数据结构的基础，广泛用于生成指向特定内存位置的指针。</p>
<p>以下是对 SPIR-V 中 <code>OpAccessChain</code> 的详细介绍：</p>
<hr />
<h2 id="1-opaccesschain"><strong>1. OpAccessChain 的基本定义</strong></h2>
<p><code>OpAccessChain</code> 的作用是从一个基对象（可以是数组、结构体或其他复合类型）出发，根据一系列索引值，计算出目标位置的指针。返回的结果是一个指向该位置的指针。</p>
<h3 id="_1">指令格式</h3>
<pre><code>OpAccessChain &lt;Result Type&gt; &lt;Result ID&gt; &lt;Base ID&gt; &lt;Index 0&gt; &lt;Index 1&gt; ...
</code></pre>
<h3 id="_2">参数说明</h3>
<ul>
<li><strong>Result Type</strong>: 指令返回的指针类型，表示计算得到的目标地址的类型。</li>
<li><strong>Result ID</strong>: 结果指针的 ID。</li>
<li><strong>Base ID</strong>: 基对象的指针 ID，通常是一个指向数组、结构体或其他复合类型的指针。</li>
<li><strong>Index 0, Index 1, ...</strong>: 一组索引值（可以是常量或动态值），用来逐层访问复合数据结构。</li>
</ul>
<h3 id="_3">返回值</h3>
<ul>
<li>返回值是一个指针，指向目标内存位置。</li>
</ul>
<hr />
<h2 id="2-opaccesschain"><strong>2. OpAccessChain 的典型使用场景</strong></h2>
<h3 id="a"><strong>a) 访问数组中的元素</strong></h3>
<p>如果有一个指向数组的指针（如 <code>Base</code>），可以通过 <code>OpAccessChain</code> 指定索引值来计算数组中某个元素的地址。</p>
<p>例如：</p>
<pre><code class="language-c++">%array = OpTypeArray %int %size    ; 定义一个数组类型
%ptr_array = OpTypePointer Uniform %array ; 定义指向数组的指针类型
%base = OpVariable %ptr_array Uniform ; 定义一个数组变量
%index = OpConstant %int 2 ; 索引值（常量）
%element_ptr = OpAccessChain %ptr_int %base %index ; 获取数组中第2个元素的指针
</code></pre>
<p>解释：
- <code>%base</code> 是一个指向数组的指针。
- <code>%index</code> 是索引值（访问数组的第2个元素）。
- <code>%element_ptr</code> 是返回的指针，指向数组中第2个元素。</p>
<h3 id="b"><strong>b) 访问结构体中的成员</strong></h3>
<p>结构体的每个成员都有一个固定的索引值，从 0 开始。通过 <code>OpAccessChain</code> 可以访问特定成员。</p>
<p>例如：</p>
<pre><code class="language-c++">%struct = OpTypeStruct %int %float %vec3 ; 定义一个结构体类型
%ptr_struct = OpTypePointer Uniform %struct ; 定义指向结构体的指针类型
%base = OpVariable %ptr_struct Uniform ; 定义一个结构体变量
%member_index = OpConstant %int 1 ; 索引值（访问 float 成员）
%member_ptr = OpAccessChain %ptr_float %base %member_index ; 获取结构体中 float 成员的指针
</code></pre>
<p>解释：
- <code>%base</code> 是指向结构体的指针。
- <code>%member_index</code> 是索引值（1 表示结构体的第二个成员，即 <code>float</code>）。
- <code>%member_ptr</code> 是返回的指针，指向结构体中 <code>float</code> 成员。</p>
<h3 id="c"><strong>c) 访问多层复合类型</strong></h3>
<p><code>OpAccessChain</code> 支持嵌套访问。例如，访问数组中的结构体成员。</p>
<p>例如：</p>
<pre><code class="language-c++">%array_struct = OpTypeArray %struct %size ; 数组类型，元素是结构体
%ptr_array_struct = OpTypePointer Uniform %array_struct ; 指向数组的指针类型
%base = OpVariable %ptr_array_struct Uniform ; 定义一个数组变量
%array_index = OpConstant %int 3 ; 数组索引
%member_index = OpConstant %int 0 ; 结构体成员索引
%member_ptr = OpAccessChain %ptr_int %base %array_index %member_index ; 访问第3个结构体的第1个成员
</code></pre>
<p>解释：
- <code>%base</code> 是指向数组的指针。
- <code>%array_index</code> 是数组索引（访问第3个结构体）。
- <code>%member_index</code> 是结构体索引（访问结构体的第1个成员）。
- <code>%member_ptr</code> 是返回的指针，指向数组中第3个结构体的第1个成员。</p>
<hr />
<h2 id="3-opaccesschain-opptraccesschain"><strong>3. OpAccessChain 与 OpPtrAccessChain 的区别</strong></h2>
<p>SPIR-V 中还有一个类似的指令 <code>OpPtrAccessChain</code>，它们的区别在于是否支持动态偏移：</p>
<ul>
<li><strong>OpAccessChain</strong>: 只能访问固定偏移的内存地址，适合静态索引或简单的内存访问。</li>
<li><strong>OpPtrAccessChain</strong>: 支持动态偏移的内存地址访问，适用于更复杂的情况。</li>
</ul>
<p><code>OpPtrAccessChain</code> 的使用方法类似，但会多一个动态偏移参数。</p>
<hr />
<h2 id="4"><strong>4. 注意事项</strong></h2>
<ol>
<li><strong>索引的范围</strong>: 对于数组、结构体等复合类型，索引值必须在合法范围内，否则会导致未定义行为。</li>
<li><strong>指针类型匹配</strong>: <code>OpAccessChain</code> 返回的指针类型必须与被访问数据的类型匹配。</li>
<li><strong>多层索引</strong>: 每个索引用来访问对应层级的复合类型，比如数组索引是访问数组的元素，结构体索引是访问结构体的成员。</li>
</ol>
<hr />
<h2 id="5"><strong>5. 示例代码总结</strong></h2>
<p>以下是一个完整的 SPIR-V 示例代码，展示如何使用 <code>OpAccessChain</code> 访问不同的复合类型：</p>
<pre><code class="language-c++">; 定义基础类型
%int = OpTypeInt 32 1
%float = OpTypeFloat 32

; 定义结构体类型
%struct = OpTypeStruct %int %float

; 定义数组类型
%array = OpTypeArray %struct %size

; 定义指针类型
%ptr_array = OpTypePointer Uniform %array
%ptr_struct = OpTypePointer Uniform %struct
%ptr_int = OpTypePointer Uniform %int
%ptr_float = OpTypePointer Uniform %float

; 定义变量
%base = OpVariable %ptr_array Uniform

; 访问数组中的第2个结构体
%index = OpConstant %int 2
%struct_ptr = OpAccessChain %ptr_struct %base %index

; 访问结构体中的第1个成员
%member_index = OpConstant %int 0
%member_ptr = OpAccessChain %ptr_int %struct_ptr %member_index
</code></pre>
<hr />
<p>通过 <code>OpAccessChain</code>，SPIR-V 能够以高效和灵活的方式访问复杂数据结构，是 GPU 计算中不可或缺的工具之一。</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../js/base.js"></script>
        <script src="../../../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
