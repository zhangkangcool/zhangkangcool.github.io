<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Calling Convention - My Docs</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../register/register/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Operand/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#ppc-elf-calling-convention" class="nav-link">PPC ELF Calling Convention</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#csr-register" class="nav-link">CSR register</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="ppc-elf-calling-convention">PPC ELF Calling Convention</h2>
<p><code>CCPromoteToType</code>会提升到64位</p>
<h4 id="def-cc_"><code>def CC_</code>传参</h4>
<pre><code class="language-c++">127 // Simple calling convention for 64-bit ELF PowerPC fast isel.
128 // Only handle ints and floats.  All ints are promoted to i64.
129 // Vector types and quadword ints are not handled.
130 let Entry = 1 in
131 def CC_PPC64_ELF_FIS : CallingConv&lt;[
132   CCIfCC&lt;&quot;CallingConv::AnyReg&quot;, CCDelegateTo&lt;CC_PPC64_AnyReg&gt;&gt;,
133
134   CCIfType&lt;[i1],  CCPromoteToType&lt;i64&gt;&gt;,
135   CCIfType&lt;[i8],  CCPromoteToType&lt;i64&gt;&gt;,
136   CCIfType&lt;[i16], CCPromoteToType&lt;i64&gt;&gt;,
137   CCIfType&lt;[i32], CCPromoteToType&lt;i64&gt;&gt;,
138   CCIfType&lt;[i64], CCAssignToReg&lt;[X3, X4, X5, X6, X7, X8, X9, X10]&gt;&gt;,
139   CCIfType&lt;[f32, f64], CCAssignToReg&lt;[F1, F2, F3, F4, F5, F6, F7, F8]&gt;&gt;
140 ]&gt;;
</code></pre>
<h4 id="def-retcc"><code>def RetCC</code>传返回值</h4>
<pre><code class="language-c++">142 // Simple return-value convention for 64-bit ELF PowerPC fast isel.
143 // All small ints are promoted to i64.  Vector types, quadword ints,
144 // and multiple register returns are &quot;supported&quot; to avoid compile
145 // errors, but none are handled by the fast selector.
146 let Entry = 1 in
147 def RetCC_PPC64_ELF_FIS : CallingConv&lt;[
148   CCIfCC&lt;&quot;CallingConv::AnyReg&quot;, CCDelegateTo&lt;RetCC_PPC64_AnyReg&gt;&gt;,
149
150   CCIfType&lt;[i1],   CCPromoteToType&lt;i64&gt;&gt;,
151   CCIfType&lt;[i8],   CCPromoteToType&lt;i64&gt;&gt;,
152   CCIfType&lt;[i16],  CCPromoteToType&lt;i64&gt;&gt;,
153   CCIfType&lt;[i32],  CCPromoteToType&lt;i64&gt;&gt;,
154   CCIfType&lt;[i64],  CCAssignToReg&lt;[X3, X4, X5, X6]&gt;&gt;,
155   CCIfType&lt;[i128], CCAssignToReg&lt;[X3, X4, X5, X6]&gt;&gt;,
156   CCIfType&lt;[f32],  CCAssignToReg&lt;[F1, F2, F3, F4, F5, F6, F7, F8]&gt;&gt;,
157   CCIfType&lt;[f64],  CCAssignToReg&lt;[F1, F2, F3, F4, F5, F6, F7, F8]&gt;&gt;,
158   CCIfType&lt;[f128],
159            CCIfSubtarget&lt;&quot;hasP9Vector()&quot;,
160            CCAssignToReg&lt;[V2, V3, V4, V5, V6, V7, V8, V9]&gt;&gt;&gt;,
161   CCIfType&lt;[v4f64, v4f32, v4i1],
162            CCIfSubtarget&lt;&quot;hasQPX()&quot;, CCAssignToReg&lt;[QF1, QF2]&gt;&gt;&gt;,
163   CCIfType&lt;[v16i8, v8i16, v4i32, v2i64, v1i128, v4f32, v2f64],
164            CCIfSubtarget&lt;&quot;hasAltivec()&quot;,
165            CCAssignToReg&lt;[V2, V3, V4, V5, V6, V7, V8, V9]&gt;&gt;&gt;
166 ]&gt;;
</code></pre>
<hr />
<h2 id="csr-register">CSR register</h2>
<p>可在<code>PPCCallingConv.td</code>中看到CSR寄存器的信息。继承自<code>CalleeSavedRegs</code></p>
<pre><code class="language-c++">283 def CSR_Altivec : CalleeSavedRegs&lt;(add V20, V21, V22, V23, V24, V25, V26, V27,
284                                        V28, V29, V30, V31)&gt;;
285
286 def CSR_Darwin32 : CalleeSavedRegs&lt;(add R13, R14, R15, R16, R17, R18, R19, R20,
287                                         R21, R22, R23, R24, R25, R26, R27, R28,
288                                         R29, R30, R31, F14, F15, F16, F17, F18,
289                                         F19, F20, F21, F22, F23, F24, F25, F26,
290                                         F27, F28, F29, F30, F31, CR2, CR3, CR4
291                                    )&gt;;
292
293 def CSR_Darwin32_Altivec : CalleeSavedRegs&lt;(add CSR_Darwin32, CSR_Altivec)&gt;;
294
295 // SPE does not use FPRs, so break out the common register set as base.
296 def CSR_SVR432_COMM : CalleeSavedRegs&lt;(add R14, R15, R16, R17, R18, R19, R20,
297                                           R21, R22, R23, R24, R25, R26, R27,
298                                           R28, R29, R30, R31, CR2, CR3, CR4
299                                       )&gt;;
300 def CSR_SVR432 :  CalleeSavedRegs&lt;(add CSR_SVR432_COMM, F14, F15, F16, F17, F18,
301                                         F19, F20, F21, F22, F23, F24, F25, F26,
302                                         F27, F28, F29, F30, F31
303                                    )&gt;;
304 def CSR_SPE : CalleeSavedRegs&lt;(add S14, S15, S16, S17, S18, S19, S20, S21, S22,
305                                    S23, S24, S25, S26, S27, S28, S29, S30, S31
306                               )&gt;;
307
308 def CSR_SVR432_Altivec : CalleeSavedRegs&lt;(add CSR_SVR432, CSR_Altivec)&gt;;
309
310 def CSR_SVR432_SPE : CalleeSavedRegs&lt;(add CSR_SVR432_COMM, CSR_SPE)&gt;;
311
312 def CSR_AIX32 : CalleeSavedRegs&lt;(add R13, R14, R15, R16, R17, R18, R19, R20,
313                                      R21, R22, R23, R24, R25, R26, R27, R28,
314                                      R29, R30, R31, F14, F15, F16, F17, F18,
315                                      F19, F20, F21, F22, F23, F24, F25, F26,
316                                      F27, F28, F29, F30, F31, CR2, CR3, CR4
317                                 )&gt;;
318
319 def CSR_Darwin64 : CalleeSavedRegs&lt;(add X13, X14, X15, X16, X17, X18, X19, X20,
320                                         X21, X22, X23, X24, X25, X26, X27, X28,
321                                         X29, X30, X31, F14, F15, F16, F17, F18,
322                                         F19, F20, F21, F22, F23, F24, F25, F26,
323                                         F27, F28, F29, F30, F31, CR2, CR3, CR4
324                                    )&gt;;
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js"></script>
        <script src="../../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
